<body>
    <script type="text/javascript">
        // 關鍵：一定要把這段邏輯放回來，否則畫面不會載入數據
        $(document).ready(function () {
            // 1. 初始化資料
            if (typeof ReadMembers === "function") {
                ReadMembers('Male');
                ReadMembers('Female');
                ReadMembers('VIP');
            }
            if (typeof ReadPlayers === "function") ReadPlayers();
            if (typeof CheckCourtsNum === "function") CheckCourtsNum();
            if (typeof AddPlayers === "function") AddPlayers();
            if (typeof checkPlayersCount === "function") checkPlayersCount();
            if (typeof InitHideCourtNameInput === "function") InitHideCourtNameInput();

            // 2. 初始化拖拽功能 (重新綁定新的 grouped 類別)
            if ($.fn.sortable) {
                $('ul.grouped, ul.Mgrouped').sortable({
                    group: true,
                    handle: '.sortHandle', // 如果你沒用到 handle 可以拔掉
                    update: function () {
                        if (typeof CheckArray === "function") CheckArray();
                        checkPlayersCount();
                        var n_del = $('.DelZone li').length;
                        if (n_del >= 1) { $('.DelZone li').remove(); }
                        if (typeof CheckElement === "function") CheckElement();
                        
                        // 隊員存檔邏輯
                        if (typeof checkMArray === "function") {
                            checkMArray('Male');
                            checkMArray('Female');
                            checkMArray('VIP');
                        }
                    },
                    scroll: true
                });
            }

            // 3. 綁定按鈕事件 (確保按鈕 Class 正確)
            $('.AddPlayerBtn').click(function () { AddPayPlayers(); checkPlayersCount(); WritePlayers(); CheckElement(); });
            $('.RefreshMemberBtn').click(function () { AddRestPlayers(); checkPlayersCount(); WritePlayers(); CheckElement(); });
            // ... 其餘按鈕邏輯比照辦理
        });
    </script>
</body>
